### cdap与ads广告后台数据验证脚本使用说明

#### 脚本功能

> 取当天的cdap页面ROAS同期群d0的活跃人数和Roas分子充值金额和Roas分母花费和广告后台页同期群ROAS详细记录进行对比操作。
>
> 本测试使用币种为inr 的渠道进行验证。

### 实现逻辑差异说明

#### 查询表差异

> cdap 使用 `history_active_cohort_cost_calculate_trend` 数据表进行数据查询
>
> ads 使用`history_active_cohort_cost_calculate_trend_campaign`数据表进行数据查询

#### 花费统计逻辑差异

>
> cdap 使用入参的dates+channel 进行sum，聚合这一天的花费
>
> ads 对数据按照dates+channel+campaign_id进行数据分组， 然后根据dates+campaign_id聚合这一天这一个广告系列的花费，然后进行累加
>
> 二者的实现逻辑在花费的统计结果上会有显著的差异
>
 #### 关联表差异
>
> cdap目前只有`history_active_cohort_cost_calculate_trend`和`history_active_channel_config_detail`关联查询
>
> ads 目前`ad_keywords_campaign`+`history_active_cohort_cost_calculate_trend_campaign`+`history_active_channel_config_detail`三者关联查询
>
> ads 广告后台目前内联`ad_keywords_campaign`这个表，这个表里边不会有自然量的统计数据的广告系列id，所以二者的在充值金额和新增注册数上都会有差异

### 配置说明

数据库连接配置同历史版本保持一致

![image-20251111213032418](使用说明文档.assets/image-20251111213032418-1762867834691-43.png)

### Excel 对比说明

cdap 新增注册人数对比说明，注册日期和行为日期需要选择一天，与cdap-web页面对比求和相同都是2636，目前看是因为自然量Organic导致数据不一致

![image-20251111211309957](使用说明文档.assets/image-20251111211309957-1762867218626-31-1762867748145-41.png)

![image-20251111163951615](使用说明文档.assets/image-20251111163951615-1762850393450-5-1762852325328-19-1762867216737-29.png)

广告后台详情数据2611未包含自然量

![image-20251111211521808](使用说明文档.assets/image-20251111211521808-1762867214997-27-1762867744274-39.png)

![image-20251111211823884](使用说明文档.assets/image-20251111211823884-1762867742417-37.png)

广告后台花费正确性对比

目前怀疑是具有channel为null或者为空的数据特征的数据导致广告后台统计的花费比cdap-web端的花费更大，因广告后台的是按照dates+campaign_id 来取的花费，cdap是按照dates+channel+campaign_id来聚合的花费，所以目前打印了ads正在使用花费逻辑（未带channel）和正确逻辑（带channel）进行数据详情对比验证。

![image-20251111212313928](使用说明文档.assets/image-20251111212313928-1762867739954-35.png)

![image-20251111212141043](使用说明文档.assets/image-20251111212141043-1762867735848-33.png)



